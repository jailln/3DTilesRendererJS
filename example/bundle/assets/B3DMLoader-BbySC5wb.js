import{r as B,F as m,B as y}from"./readMagicBytes-C5ZyfJzm.js";import{L}from"./LoaderBase-QLlipkOW.js";import{k as w,aG as x}from"./three.module-llkpyLgW.js";import{G as U}from"./GLTFLoader-KDqsLDsn.js";class C extends L{parse(s){const t=new DataView(s),T=B(t);console.assert(T==="b3dm");const b=t.getUint32(4,!0);console.assert(b===1);const h=t.getUint32(8,!0);console.assert(h===s.byteLength);const o=t.getUint32(12,!0),a=t.getUint32(16,!0),n=t.getUint32(20,!0),r=t.getUint32(24,!0),g=28,e=s.slice(g,g+o+a),u=new m(e,0,o,a),c=g+o+a,i=s.slice(c,c+n+r),l=new y(i,u.getData("BATCH_LENGTH"),0,n,r),f=c+n+r,d=new Uint8Array(s,f,h-f);return{version:b,featureTable:u,batchTable:l,glbBytes:d}}}class G extends C{constructor(s=x){super(),this.manager=s,this.adjustmentTransform=new w}parse(s){const t=super.parse(s),T=t.glbBytes.slice().buffer;return new Promise((b,h)=>{const o=this.manager,a=this.fetchOptions,n=o.getHandler("path.gltf")||new U(o);a.credentials==="include"&&a.mode==="cors"&&n.setCrossOrigin("use-credentials"),"credentials"in a&&n.setWithCredentials(a.credentials==="include"),a.headers&&n.setRequestHeader(a.headers);let r=this.workingPath;!/[\\/]$/.test(r)&&r.length&&(r+="/");const g=this.adjustmentTransform;n.parse(T,r,e=>{const{batchTable:u,featureTable:c}=t,{scene:i}=e,l=c.getData("RTC_CENTER");l&&(i.position.x+=l[0],i.position.y+=l[1],i.position.z+=l[2]),e.scene.updateMatrix(),e.scene.matrix.multiply(g),e.scene.matrix.decompose(e.scene.position,e.scene.quaternion,e.scene.scale),e.batchTable=u,e.featureTable=c,i.batchTable=u,i.featureTable=c,b(e)},h)})}}export{G as B};
