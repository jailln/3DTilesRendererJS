class r{constructor({apiToken:t,assetId:s=null}){this.name="CESIUM_ION_AUTH_PLUGIN",this.apiToken=t,this.assetId=s,this.tiles=null,this._tileSetVersion=-1,this._tokenState=0,this._loadPromise=null}init(t){this.tiles=t}loadRootTileSet(t){if(this._tokenState===0){this._tokenState=1;let s;this.assetId===null?s=new URL(t):s=new URL(`https://api.cesium.com/v1/assets/${this.assetId}/endpoint`),s.searchParams.append("access_token",this.apiToken),this._loadPromise=fetch(s,{mode:"cors"}).then(e=>e.ok?e.json():Promise.reject(new Error(`${e.status} : ${e.statusText}`))).then(e=>{this._tokenState=2;const o=this.tiles,i=new URL(e.url);return this._tileSetVersion=i.searchParams.get("v"),o.rootURL=i,o.fetchOptions.headers=o.fetchOptions.headers||{},o.fetchOptions.headers.Authorization=`Bearer ${e.accessToken}`,o.loadRootTileSet(o.rootURL)}).catch(e=>(this._tokenState=3,Promise.reject(e)))}return this._loadPromise}preprocessURL(t){return t=new URL(t),/^http/.test(t.protocol)&&this._tileSetVersion!=-1&&t.searchParams.append("v",this._tileSetVersion),t.toString()}}export{r as C};
